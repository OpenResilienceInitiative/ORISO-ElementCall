<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <% if (packageType === "full") { %>
    <link rel="icon" type="image/svg+xml" href="favicon.png" />
    <link rel="preload" href="/config.json" as="fetch" />
    <% } %>

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <title>Call</title>
    <script>
      window.global = window;
    </script>
    <style>
      :root,
      html,
      body,
      #root {
        background: #000 !important;
        background-image: none !important;
        --background-gradient: none !important;
      }
    </style>
    <script>
      (function() {
        var body = document.body;
        var html = document.documentElement;
        function forceBlack() {
          if (!body) body = document.body;
          if (!body) return;
          body.style.setProperty("background-image", "none", "important");
          body.style.setProperty("background", "#000", "important");
          body.style.setProperty("--background-gradient", "none", "important");
          html.style.setProperty("background-image", "none", "important");
          html.style.setProperty("background", "#000", "important");
          html.style.setProperty("--background-gradient", "none", "important");
        }
        forceBlack();
        setInterval(forceBlack, 250);
      })();
    </script>

    <!-- AUTO-AUTHENTICATION SCRIPT: Read Matrix credentials from URL parameters -->
    <script>
      (function() {
        console.log('üî∑ Element Call Auto-Auth Script Starting...');
        
        // Parse URL parameters (check both hash and search params)
        const hashParams = window.location.hash.includes('?') 
          ? new URLSearchParams(window.location.hash.split('?')[1])
          : new URLSearchParams();
        const searchParams = new URLSearchParams(window.location.search);
        
        // Get credentials from URL (check both locations)
        const accessToken = hashParams.get('accessToken') || searchParams.get('accessToken');
        const userId = hashParams.get('userId') || searchParams.get('userId');
        const deviceId = hashParams.get('deviceId') || searchParams.get('deviceId');
        const homeserver = hashParams.get('homeserver') || searchParams.get('homeserver');
        
        console.log('üîç Checking for Matrix credentials in URL...');
        console.log('   User ID:', userId || 'NOT FOUND');
        console.log('   Token:', accessToken ? 'EXISTS (length: ' + accessToken.length + ')' : 'NOT FOUND');
        console.log('   Device ID:', deviceId || 'NOT FOUND');
        console.log('   Homeserver:', homeserver || 'NOT FOUND');
        
        if (accessToken && userId) {
          console.log('‚úÖ Matrix credentials found in URL! Setting up Element Call session...');
          
          try {
            // Element Call expects session in localStorage with key "matrix-auth-store"
            // Format: { user_id, device_id, access_token, passwordlessUser }
            const session = {
              user_id: userId,
              device_id: deviceId || 'element-call-device',
              access_token: accessToken,
              passwordlessUser: false
            };
            
            localStorage.setItem('matrix-auth-store', JSON.stringify(session));
            
            console.log('‚úÖ Element Call session created in localStorage');
            console.log('   Session:', { user_id: userId, device_id: session.device_id, has_token: !!accessToken });
            console.log('‚úÖ Element Call will auto-authenticate on load!');
          } catch (e) {
            console.error('‚ùå Failed to create Element Call session:', e);
          }
        } else {
          console.log('‚ÑπÔ∏è  No Matrix credentials in URL (normal for direct access)');
        }
      })();
    </script>

    <% if (packageType === "full") { %>
    <!-- Open graph meta tags -->

    <meta property="og:title" content="<%- brand %>" />
    <meta
      property="og:description"
      content="You're invited to join a call on <%- brand %>"
    />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="favicon.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="<%- brand %>" />
    <meta
      name="twitter:description"
      content="You're invited to join a call on <%- brand %>"
    />
    <meta name="twitter:image" content="favicon.png" />
    <% } %>
  </head>

  <!-- The default class is: .no-theme {display: none}. It will be overwritten once the app is loaded. -->
  <body class="no-theme" style="background:#000 !important; background-image:none !important;">
    <div id="root"></div>
  </body>
</html>
